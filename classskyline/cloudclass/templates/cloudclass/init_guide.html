{% load static from staticfiles %}
<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en" class="no-js">
<!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
    <meta charset="utf-8"/>
    <title>云学堂管理平台</title>
    <!--<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=9">-->
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="renderer" content="webkit">
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <meta content="" name="description"/>
    <meta content="" name="author"/>
    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="{% static 'assets/admin/layout/css/googlefonts.css' %}" rel="stylesheet" type="text/css"/>
    <link href="{% static 'assets/global/plugins/font-awesome/css/font-awesome.min.css' %}" rel="stylesheet"
          type="text/css"/>
    <link href="{% static 'assets/global/plugins/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet" type="text/css"/>
    <link href="{% static 'assets/global/plugins/uniform/css/uniform.default.css' %}" rel="stylesheet" type="text/css"/>
    <link href="{% static 'assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css' %}" rel="stylesheet"
          type="text/css"/>
    <!-- END GLOBAL MANDATORY STYLES -->

    <!-- BEGIN PAGE STYLES -->
    <link href="{% static 'assets/admin/pages/css/tasks.css' %}" rel="stylesheet" type="text/css"/>
    <!-- END PAGE STYLES -->
    <!-- BEGIN THEME STYLES -->
    <!-- DOC: To use 'rounded corners' style just load 'components-rounded.css' stylesheet instead of 'components.css' in the below style tag -->
    <link href="{% static 'assets/global/css/components-rounded.css' %}" id="style_components" rel="stylesheet"
          type="text/css"/>
    <link href="{% static 'assets/global/css/plugins.css' %}" rel="stylesheet" type="text/css"/>
    <link href="{% static 'assets/admin/layout/css/layout.css' %}" rel="stylesheet" type="text/css"/>
    <link href="{% static 'assets/admin/layout/css/themes/darkblue.css' %}" rel="stylesheet" type="text/css"
          id="style_color"/>
    <link href="{% static 'assets/admin/layout/css/custom.css' %}" rel="stylesheet" type="text/css"/>
    <link href="{% static 'assets/global/plugins/dialog/jquery_dialog.css' %}" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet"
          href="{% static 'assets/global/plugins/bootstrapvalidator/css/bootstrapValidator.min.css' %}">

    <!-- 步骤指引 -->
    <link rel="stylesheet" href="{% static 'assets/global/css/wizard-step.css' %}">
    <style type="text/css">
        body {
            background: #193050;
        }

        .bg {
            display: none;
            position: fixed;
            width: 100%;
            height: 100%;
            background: #999;
            z-index: 2;
            top: 0;
            left: 0;
            opacity: 0.7;
        }

        label > span {
            color: red;
        }

        .page-container {
            margin-top: 0 !important;
            height: 100% !important;
        }

        .page-content-wrapper .page-content {
            margin-left: 0;
        }

        .page-container {
            height: 100%;
        }

        .page-content {
            height: 100%;
        }

        .form-control-feedback {
            margin-top: 10px;
        }

        ::-webkit-input-placeholder {
            color: #737373;
        }

        ::-moz-placeholder {
            color: #737373;
        }

        /* firefox 19+ */
        :-ms-input-placeholder {
            color: #737373;
        }

        /* ie */
        input:-moz-placeholder {
            color: #737373;
        }
        .form-header {
            text-align: center;
            font-weight: bold;
        }
    </style>
    <!-- END THEME STYLES -->

</head>

<body class="page-header-fixed page-quick-sidebar-over-content page-style-square " id="mainload">

<div class="clearfix">
</div>
<!-- BEGIN CONTAINER -->
<div class="page-container">
    <!-- BEGIN CONTENT -->
    <div class="page-content-wrapper">
        <div class="page-content" style="min-height:933px;">
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="portlet box darkgray">
                        <div class="portlet-title">
                            <div class="caption">
                                初始化设置
                            </div>
                        </div>

                        <div class="container">
                            <div class="row bs-wizard" style="border-bottom:0;">

                                <div class="col-xs-4 bs-wizard-step {% if step == 1 %}active{% else %}complete{% endif %}">
                                    <div class="text-center bs-wizard-stepnum">Step 1</div>
                                    <div class="progress">
                                        <div class="progress-bar"></div>
                                    </div>
                                    <a href="#" class="bs-wizard-dot"></a>

                                    <div class="bs-wizard-info text-center">CAS设置</div>
                                </div>

                                <div class="col-xs-4 bs-wizard-step {% if step == 2 %}active{% elif step == 3 %}complete{% else %}disabled{% endif %}"><!-- complete -->
                                    <div class="text-center bs-wizard-stepnum">Step 2</div>
                                    <div class="progress">
                                        <div class="progress-bar"></div>
                                    </div>
                                    <a href="#" class="bs-wizard-dot"></a>

                                    <div class="bs-wizard-info text-center">主机设置
                                    </div>
                                </div>

                                <div class="col-xs-4 bs-wizard-step {% if step == 3 %}active{% else %}disabled{% endif %}"><!-- complete -->
                                    <div class="text-center bs-wizard-stepnum">Step 3</div>
                                    <div class="progress">
                                        <div class="progress-bar"></div>
                                    </div>
                                    <a href="#" class="bs-wizard-dot"></a>

                                    <div class="bs-wizard-info text-center">网络设置
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="portlet-body">
                            {% if step == 1 %}
                                <form class="form-horizontal" id="id_cas_form" method="post"
                                      action="{% url 'stack_backends' %}">
                                    <div class="form-body">
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label"> <span>*</span> CAS CVM地址</label>

                                            <div class="col-sm-6">
                                                <input type="text" class="form-control" name="cas_address"
                                                       id="id_cas_address"
                                                       value="http://192.168.86.100:8080"/>
                                                <span class="help-inline">请保证以http://开头</span>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="col-sm-3 control-label" for="id_username"><span>*</span>
                                                用户名</label>

                                            <div class="col-sm-6">
                                                <input type="text" class="form-control" name="username" id="id_username"
                                                       value="admin">
                                                <span class="help-inline"></span>
                                            </div>

                                        </div>

                                        <div class="form-group">
                                            <label class="col-sm-3 control-label" for="id_password"><span>*</span>
                                                密码</label>

                                            <div class="col-sm-6">
                                                <input type="password" class="form-control" name="password"
                                                       id="id_password" value=""/>
                                                <span class="help-inline"></span>
                                            </div>
                                        </div>

                                        <div class="alert alert-danger" style="display: none;">
                                            <label id="errorMessage"></label>
                                        </div>

                                        <div class="margin-bottom-20">
                                            <div class="row">
                                                <div class="col-sm-offset-3 col-sm-9">
                                                    <button class="btn blue" type="submit" id="btnSubmit"
                                                            style="padding: 8px 18px;"> 下一步
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- END FORM-->
                                </form>
                            {% elif step == 2 %}
                                <form class="form-horizontal" id="id_host_form" method="post"
                                      action="{% url 'set_host' %}">
                                    <div class="form-body">
                                        <div class="form-group">
                                            <label for="id_hostpool" class="col-sm-3 control-label"><span>*</span> 主机池名称</label>

                                            <div class="col-sm-6">
                                                <input type="text" class="form-control" name="hostpool" value="hccpool"
                                                       id="id_hostpool" readonly>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="id_host_name" class="col-sm-3 control-label"><span>*</span> 主机地址</label>

                                            <div class="col-sm-6">
                                                <input type="text" class="form-control" name="host_name"
                                                       value="{{ host_name }}" id="id_host_name" readonly>
                                            </div>
                                            <span class="help-block"></span>
                                        </div>
                                        <div class="form-group">
                                            <label for="id_host_username" class="col-sm-3 control-label"><span>*</span>
                                                主机用户名</label>

                                            <div class="col-sm-6">
                                                <input type="text" class="form-control" name="host_username"
                                                       value="root" id="id_host_username">
                                                <span class="help-inline"></span>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="id_host_password" class="col-sm-3 control-label"><span>*</span>
                                                主机密码</label>

                                            <div class="col-sm-6">
                                                <input type="password" class="form-control" name="host_password"
                                                       id="id_host_password">
                                                <span class="help-inline"></span>
                                            </div>
                                        </div>

                                        <div class="margin-bottom-20">
                                            <div class="row">
                                                <div class="col-sm-offset-3 col-sm-9">
                                                    <button class="btn blue" type="submit" id="set_host_submit"
                                                            style="padding: 8px 18px;"> 下一步
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            {% elif step == 3 %}
                                <form class="form-horizontal" id="id_param_form" method="post"
                                      action="{% url 'param_set' %}">
                                    <div class="form-body">
                                        <hr>
                                        <div class="form-group">
                                            <h3 class="col-sm-12 form-header">虚拟交换机的基本信息</h3>
                                        </div>
                                        {% if pnics %}
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label"
                                                       for="id_vswitch_name"><span>*</span>
                                                    vSwitch名称</label>

                                                <div class="col-sm-6">
                                                    <input type="text" name="vswitch_name" class="form-control"
                                                           value="hccvswitch" id="id_vswitch_name" readonly>
                                                    <span class="help-inline"></span>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-3 control-label" for=""><span>*</span> 网卡</label>

                                                <div class="col-sm-6">
                                                    {% for n in pnics %}
                                                        <label class="checkbox-inline">
                                                            <input type="checkbox" id="id_{{ n }}" value="{{ n }}"
                                                                   name="pnics[]"> {{ n }}
                                                        </label>
                                                    {% endfor %}
                                                    <span class="help-block">当前已经被使用的网卡不可使用，未显示</span>
                                                </div>
                                            </div>

                                            <div class="form-group enable_lacp" style="display: none;">
                                                <label class="col-sm-3 control-label" for=""><span>*</span>
                                                    链路聚合模式</label>

                                                <div class="col-sm-6">
                                                    <label class="radio-inline">
                                                        <input type="radio" name="enable_lacp" value="0" checked> 静态链路聚合
                                                    </label>
                                                    <label class="radio-inline">
                                                        <input type="radio" name="enable_lacp" value="1"> 动态链路聚合
                                                    </label>
                                                    <span class="help-block lacp_help" style="display: none;">动态链路聚合需要交换机侧启用LACP</span>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-3 control-label"
                                                       for="id_vswitch_address"><span>*</span> vSwitch地址</label>

                                                <div class="col-sm-6">
                                                    <input type="text" name="vswitch_address" class="form-control"
                                                           id="id_vswitch_address">
                                                    <span class="help-inline">虚拟交换机的IP地址,如：192.168.100.99</span>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-3 control-label"
                                                       for="id_vswitch_netmask"><span>*</span> vSwitch子网掩码</label>

                                                <div class="col-sm-6">
                                                    <input type="text" name="vswitch_netmask" class="form-control"
                                                           id="id_vswitch_netmask">
                                                    <span class="help-inline">例如： 255.255.255.0</span>
                                                </div>
                                            </div>
                                            <input type="hidden" name="custom" value="1"> {# custom代表新建vswitch #}

                                        {% else %}
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label"
                                                       for="id_vswitch_name"><span>*</span> vSwitch名称</label>

                                                <div class="col-sm-6">
                                                    <select name="vswitch_name" id="id_vswitch_name"
                                                            class="form-control">
                                                        <option value="">----</option>
                                                        {% for v in vswitches %}
                                                            <option value="{{ v.name }}">{{ v.name }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                            <input type="hidden" name="custom" value="0">
                                        {% endif %}

                                        {% if pnics %}
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label" for="id_gateway">网关</label>

                                            <div class="col-sm-6">
                                                <input type="text" class="form-control" id="id_gateway" name="gateway">
                                                <span class="help-inline">主机必须配置网关,且只能配置一个网关,否则网络将无法连接.</span>
                                            </div>
                                        </div>
                                        {% endif %}

                                        <!-- 网络策略模板 -->
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label" for="id_npp_name"><span>*</span>
                                                网络策略模板名称</label>

                                            <div class="col-sm-6">
                                                <input type="text" class="form-control" value="hccpolicy"
                                                       id="id_npp_name" name="npp_name" readonly>
                                                <span class="help-inline"></span>
                                            </div>
                                        </div>



                                        <div class="form-group">
                                            <label class="col-sm-3 control-label" for="id_vlan">
                                                VLAN</label>

                                            <div class="col-sm-6">
                                                <input type="number" class="form-control" min="1" max="4094" step="1" id="id_vlan" name="vlan">
                                                <span class="help-inline">VLAN为1-4094之间的数字</span>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="col-sm-3 control-label" for="id_acl_name"><span>*</span> ACL策略名称</label>

                                            <div class="col-sm-6">
                                                <input type="text" class="form-control" id="id_acl_name" name="acl_name"
                                                       value="hccacl" readonly>
                                                <span class="help-inline">若为空则无法使用禁网功能,建议开启</span>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="col-sm-3 control-label" for="id_white_list"><span>*</span> ACL策略白名单</label>

                                            <div class="col-sm-6">
                                                <input type="text" class="form-control" name="white_list"
                                                       id="id_white_list" value=""/>
                                                <span class="help-inline">例如： 10.88.16.0/23,若有多个使用逗号','分隔</span>
                                            </div>
                                        </div>

                                        <hr>
                                        <div class="form-group">
                                            <h3 class="col-sm-12 form-header">虚拟机网络设置</h3>
                                        </div>

                                        <div class="form-group">
                                            <label class="col-sm-3 control-label" for="id_ip_address_begin">
                                                虚拟机起始IP地址</label>

                                            <div class="col-sm-6">
                                                <input type="text" class="form-control" id="id_ip_address_begin" name="ip_address_begin" title="DHCP服务的IP起始地址">
                                                <span class="help-inline">DHCP给虚拟机分配IP时的起始地址</span>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="col-sm-3 control-label" for="id_ip_address_end">
                                                虚拟机结束IP地址</label>

                                            <div class="col-sm-6">
                                                <input type="text" class="form-control" id="id_ip_address_end" name="ip_address_end" title="DHCP服务的IP结束地址">
                                                <span class="help-inline">DHCP给虚拟机分配IP时的结束地址</span>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="col-sm-3 control-label" for="id_dns">DNS</label>

                                            <div class="col-sm-6">
                                                <input type="text" class="form-control" id="id_dns" name="dns">
                                                <span class="help-inline"></span>
                                            </div>
                                        </div>

                                        <div class="alert alert-danger" style="display: none;">
                                            <label id="errorMessage"></label>
                                        </div>

                                        <hr>

                                        <div class="margin-bottom-20">
                                            <div class="row">
                                                <div class="col-sm-offset-3 col-sm-9">
                                                    <button class="btn blue" type="submit" id="btnSubmit"
                                                            style="padding: 8px 18px;"> 完成配置
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- END FORM-->

                                </form>
                            {% endif %}
                        </div>
                    </div>

                </div>
            </div>
        </div>

    </div>

</div>
<!-- END CONTAINER -->


<!-- END FOOTER -->
<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
<!-- BEGIN CORE PLUGINS -->
<!--[if lt IE 9]
<script src="{% static 'assets/global/plugins/respond.min.js' %}"></script>
<script src="{% static 'assets/global/plugins/excanvas.min.js' %}"></script>
<![endif]-->
<script src="{% static 'assets/global/plugins/respond.min.js' %}"></script>

<script src="{% static 'assets/global/plugins/jquery.min.js' %}" type="text/javascript"></script>
<script src="{% static 'assets/global/plugins/jquery-migrate.min.js' %}" type="text/javascript"></script>
<script src="{% static 'assets/global/plugins/jquery-ui/jquery-ui-1.10.3.custom.min.js' %}"
        type="text/javascript"></script>
<script src="{% static 'assets/global/plugins/bootstrap/js/bootstrap.min.js' %}" type="text/javascript"></script>
<script src="{% static 'assets/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js' %}"
        type="text/javascript"></script>

<script src="{% static 'assets/global/plugins/jquery.blockui.min.js' %}" type="text/javascript"></script>
<script src="{% static 'assets/global/plugins/jquery.cokie.min.js' %}" type="text/javascript"></script>
<script src="{% static 'assets/global/plugins/uniform/jquery.uniform.min.js' %}" type="text/javascript"></script>
<script src="{% static 'assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js' %}"
        type="text/javascript"></script>
<!-- END CORE PLUGINS -->

<!-- BEGIN PAGE LEVEL SCRIPTS -->
<script src="{% static 'assets/global/scripts/metronic.js' %}" type="text/javascript"></script>
<script src="{% static 'assets/admin/layout/scripts/layout.js' %}" type="text/javascript"></script>
<script src="{% static 'assets/admin/layout/scripts/quick-sidebar.js' %}" type="text/javascript"></script>
<script src="{% static 'assets/admin/layout/scripts/demo.js' %}" type="text/javascript"></script>
<script src="{% static 'assets/admin/pages/scripts/index.js' %}" type="text/javascript"></script>
<script src="{% static 'assets/admin/pages/scripts/tasks.js' %}" type="text/javascript"></script>
<script src="{% static 'assets/global/scripts/spiner.js' %}" type="text/javascript"></script>
<script type="text/javascript" src="{% static 'assets/global/scripts/common.js' %}"></script>
<!--提示框-->
<script type="text/javascript" src="{% static 'assets/global/scripts/Mbox.js' %}"></script>
<script type="text/javascript" src="{% static 'assets/global/scripts/circle-progress.js' %}"></script>

<!-- END PAGE LEVEL SCRIPTS -->
<script src="{% static 'assets/global/plugins/bootstrapvalidator/js/bootstrapValidator.min.js' %}"></script>
<!-- notiejs 插件-->
<script type="text/javascript" src="{% static 'assets/global/plugins/notie.js' %}"></script>
<script type="text/javascript">
    common.initmenu("log", "init_guide");

    function net_address(ip, netmask) {
        var ip_list = ip.split('.');
        var netmask_list = netmask.split('.');
        var ret = '';
        for (var i = 0; i < 4; i++) {
            ret += String(parseInt(ip_list[i]) & parseInt(netmask_list[i]));
        }
        return ret
    }

    // 扩展bootstrap
    (function($) {
        $.fn.bootstrapValidator.validators.sameNet = {
            html5Attributes: {
                message: 'message',
                field: 'field',
                netmask: 'netmask'
            },
            validate: function (validator, $field, options) {
                var value = $field.val();
                if (value === '') { return true }

                var compareWith = validator.getFieldElements(options.field);
                if (compareWith === null || compareWith.length === 0) {
                    return true;
                }

                var netmask = validator.getFieldElements(options.netmask);
                if (netmask === '' || netmask.length === 0){
                    return true;
                }

                return net_address(value, netmask.val()) === net_address(compareWith.val(), netmask.val());
            }
        }
    })(window.jQuery);

    {% if step == 1 %}
        $("#id_cas_form").bootstrapValidator({
            message: '字段不合法',
            feedbackIcons: {
                valid: 'fa fa-check',
                invalid: 'fa fa-remove',
                validating: 'fa fa-refresh'
            },
            fields: {
                cas_address: {
                    validators: {
                        notEmpty: {
                            message: "CAS CVM地址不能为空"
                        },
                        regexp: {
                            regexp: /^http:\/\/\d+\.\d+\.\d+\.\d+:\d+/,
                            message: '请输入合法的地址'
                        }
                    }
                },
                username: {
                    validators: {
                        notEmpty: {
                            message: "用户名不能为空"
                        }
                    }
                },
                password: {
                    validators: {
                        notEmpty: {
                            message: "密码不能为空"
                        }
                    }
                }
            }
        }).on("success.form.bv", function (e) {
            e.preventDefault();
            var $form = $(e.target);
            loading();
            $.ajax({
                type: "POST",
                url: "{% url 'stack_backends' %}",
                data: $form.serialize(),
                success: function (res) {
                    if (res["result"] == "ok") {
                        window.location = "{% url 'init_guide' 2 %}"
                    } else {
                        notie.alert(3, res["message"], 3);
                    }
                    spinner.stop();
                }
            });
            $(".bg").fadeOut(2000);
        });
    {% elif step == 2 %}
        $("#id_host_form").bootstrapValidator({
            message: '字段不合法',
            feedbackIcons: {
                valid: 'fa fa-check',
                invalid: 'fa fa-remove',
                validating: 'fa fa-refresh'
            },
            fields: {
                hostpool: {
                    validators: {
                        notEmpty: {
                            message: "主机池名称不能为空"
                        }
                    }
                },
                host_name: {
                    validators: {
                        notEmpty: {
                            message: "主机地址不能为空"
                        },
                        ip: {
                            message: "请输入合法的IP地址"
                        }
                    }
                },
                host_username: {
                    validators: {
                        notEmpty: {
                            message: "主机用户名不能为空"
                        }
                    }
                },
                host_password: {
                    validators: {
                        notEmpty: {
                            message: "主机密码不能为空"
                        }
                    }
                }
            }
        }).on("success.form.bv", function (e) {
            e.preventDefault();
            loading();
            var $form = $(e.target);
            $.ajax({
                type: "POST",
                url: "{% url 'set_host' %}",
                data: $form.serialize(),
                success: function (res) {
                    if (res["result"] == "ok") {
                        window.location.href = "{% url 'init_guide' 3 %}";
                    } else {
                        notie.alert(3,res['message'],3);
                    }
                    spinner.stop();
                }
            });
            $(".bg").fadeOut(2000);
        });
    {% elif step == 3 %}

        $("input[name='enable_lacp']").on("change", function() {
            var _self = $(this);
            var v = _self.val();
            if (v == '1') {
                $(".lacp_help").show();
            } else {
                $(".lacp_help").hide();
            }
        });

        $("#id_param_form").bootstrapValidator({
            message: '字段不合法',
            feedbackIcons: {
                valid: 'fa fa-check',
                invalid: 'fa fa-remove',
                validating: 'fa fa-refresh'
            },
            fields: {
                white_list: {
                    validators: {
                        notEmpty: {
                            message: "白名单不能为空"
                        }
                    }
                },
                vswitch_name: {
                    validators: {
                        notEmpty: {
                            message: "vSwitch名称不能为空"
                        }
                    }
                },
                {% if pnics %}
                    'pnics[]': {
                    validators: {
                        notEmpty: {
                            message: "至少选择一个网卡"
                        }
                    }
                },
                {% endif %}
                vswitch_address: {
                    validators: {
                        notEmpty: {
                            message: "vSwitch地址不能为空"
                        },
                        ip: {
                            message: "请输入合法的vSwitch地址"
                        }
                    }
                },
                vswitch_netmask: {
                    validators: {
                        notEmpty: {
                            message: "vSwitch子网掩码不能为空"
                        },
                        ip: {
                            message: "输入合法的vSwitch子网掩码"
                        }
                    }
                },
                npp_name: {
                    validators: {
                        notEmpty: {
                            message: "网络策略模板名称不能为空"
                        }
                    }
                },
                vlan: {
                    validators: {
                        lessThan: {
                            value: 4094,
                            inclusive: true,
                            message: "VLAN不能大于4094"
                        },
                        greaterThan: {
                            value: 1,
                            inclusive: true,
                            message: "VLAN不能小于1"
                        }
                    }
                },
                ip_address_begin: {
                    validators: {
                        ip: {
                            message: "请输入合法的IP地址"
                        }
{#                        sameNet: {#}
{#                            field: 'ip_address_end',#}
{#                            netmask: 'vswitch_netmask',#}
{#                            message: "起始和终止IP不在同一网段"#}
{#                        }#}
                    }
                },
                ip_address_end: {
                    validators: {
                        ip: {
                            message: "请输入合法的IP地址"
                        },
                        sameNet: {
                            field: 'ip_address_begin',
                            netmask: 'vswitch_netmask',
                            message: "起始和终止IP不在同一网段"
                        }
                    }
                },
                dns: {
                    validators: {
                        ip: {
                            message: "输入合法的IP地址"
                        }
                    }
                },
                gateway: {
                    validators: {
                        ip: {
                            message: '请输入合法的网关'
                        }
                    }
                }
            }
        }).on("success.form.bv", function (e) {
            e.preventDefault();
            loading();
            var $form = $(e.target);
            $.ajax({
                type: "POST",
                url: "{% url 'param_set' %}",
                data: $form.serialize(),
                success: function (res) {
                    if (res['result'] == 'ok') {
                        location.href = "{% url 'dash_board' %}";
                    } else {
                        notie.alert(1,res['message'],2);
                    }
                    spinner.stop();
                },
                error: function(res) {
                    notie.alert(3,res['message'],3);
                    spinner.stop();
                    $(".bg").fadeOut(2000);
                }
            });

        });

        $("input[name='pnics[]']").on("click", function () {
            var total = $("input[name='pnics[]']:checked").length;
            if (total > 1) {
                $(".enable_lacp").show();
            } else {
                $(".enable_lacp").hide();
            }
        });
    {% endif %}
</script>

<!-- END JAVASCRIPTS -->
</body>
<!-- END BODY -->
</html>