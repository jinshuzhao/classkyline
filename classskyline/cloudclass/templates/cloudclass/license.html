{% extends 'sitebase.html' %}
{% load static from staticfiles %}

{% block ext_style %}
    <style type="text/css">
        label > span {
            color: red;
        }
        #SWFUpload_0 {
            margin-left: -40px;
        }

        .bv-form .help-block {
            margin-top: 0px;
            padding-bottom: 0;
        }

        input, select {
            margin-bottom: 15px;
        }

        .btn.darkgray:hover span,
        .btn.darkgray:hover i{
            color:#2374c6;
        }
    </style>
{% endblock %}

{% block content %}
    <!-- BEGIN PAGE HEADER-->
    <div class="page-bar">
        <ul class="page-breadcrumb">
            <li>
                <i class="fa fa-home"></i>
                <a href="{% url 'dash_board' %}">主页</a>
                <i class="fa fa-angle-right"></i>
            </li>
            <li>
                <a href="#">系统设置</a>
            </li>
        </ul>
    </div>
    <!-- END PAGE HEADER-->

    <div class="row">
        <div class="col-md-12 col-sm-12">
            <div class="portlet box darkgray">
                <div class="portlet-title">
                    <ul class="nav nav-tabs" style="float: left;">
                        <li role="presentation" class="active">
                            <a href="{% url 'license' %}#info" role="tab" aria-controls="info" data-toggle="tab">License详细信息</a>
                        </li>
                        <li role="presentation" class="">
                            <a href="{% url 'license' %}#apply" role="tab" aria-controls="apply" data-toggle="tab">正式申请License</a>
                        </li>
                        <li role="presentation" class="">
                            <a href="{% url 'license' %}#register" role="tab" aria-controls="register" data-toggle="tab">注册License</a>
                        </li>
                    </ul>
                </div>

                <div class="portlet-btn"></div>
                <div class="portlet-body">
                    <div class="tab-content ">
                        <div class="actions" style="text-align: left">
                            <div class="tab-content">
                                <div role="tabpane1" class="tab-pane active" id="info">
                                    <!-- License信息 -->
                                    <table class="table table-striped table-bordered table-hover">
                                        <tbody>
                                        <tr>
                                            <td style="width: 300px; font-weight: bold;">云桌面个数</td>
                                            <td>{{ max_users }}</td>
                                        </tr>
                                        <tr>
                                            <td style="width: 300px; font-weight: bold;">授权条码</td>
                                            <td>{{ barcode }}</td>
                                        </tr>
                                        <tr>
                                            <td style="width: 300px; font-weight: bold;">License有效期</td>
                                            <td>
                                                {% if expire_days == -1 %}永久有效
                                                {% elif expire_days == -2 %}
                                                    <span style="color: red">已过期</span>
                                                {% else %}
                                                    剩余 {{ expire_days }} 天
                                                {% endif %}
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <div role="tabpane1" class="tab-pane" id="apply">
                                    <!--  申请License -->
                                    <form class="form-horizontal" id="licenseForm" method="GET"
                                          action="{% url 'get_host_info' %}">
                                        <div class="form-body">
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label"> <span>*</span> 用户姓名</label>
                                                <div class="col-sm-6">
                                                    <input type="text" class="form-control" name="name" id="name" value=""/>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-3 control-label"><span>*</span> 国家/地区</label>
                                                <div class="col-sm-6">
                                                    <select name="country" class="form-control" id="country">
                                                        <option value="中国" selected>中国</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-3 control-label"><span>*</span> 省/市</label>
                                                <div class="col-sm-6">
                                                    <input type="text" class="form-control" name="province" id="province" value=""/>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-3 control-label"><span>*</span> 公司或单位名称</label>
                                                <div class="col-sm-6">
                                                    <input type="text" class="form-control" name="company" id="company" value=""/>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-3 control-label"><span>*</span> 邮箱</label>
                                                <div class="col-sm-6">
                                                    <input type="email" class="form-control" name="email" id="email" value=""/>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-3 control-label"><span>*</span> 联系电话</label>
                                                <div class="col-sm-6">
                                                    <input type="text" class="form-control" name="phone" id="phone" value=""/>
                                                </div>
                                            </div>

                                            <div class="alert alert-danger" style="display: none;">
                                                <label id="errorMessage"></label>
                                            </div>

                                            <div class="margin-bottom-20">
                                                <div class="row">
                                                    <div class="col-sm-offset-3 col-sm-9">
                                                        <button class="btn blue" type="submit" id="btnSubmit" style="padding: 8px 18px;">提 交</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- END FORM-->
                                    </form>
                                </div>
                                <div role="tabpane1" class="tab-pane" id="register">

                                    <form id="form4" class="form-horizontal" action="." method="post" enctype="multipart/form-data">
                                        <div class="form-body">
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label"> <span>*</span>上传licence</label>
                                                <div class="col-sm-6">

                                                   <span class="btn  darkgray "><i class="fa fa-upload" style="display: inline-block;float:left;font-size:12px;margin-top:3px;"></i>
                                                       <input type="file" class="fileupload-new" id="btn_upload1"/>
                                                   </span>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock content %}

{% block script %}
    <script src="{% static 'assets/global/plugins/upload/jquery.uploadify.min.js' %}"></script>

    <script type="text/javascript">
        function uploadfile(num, type) {
            //上传按钮操作
            setTimeout(function () {
                $("#btn_upload" + num).uploadify({
                    "auto": true,
                    "buttonText": "上传",
                    "swf": '/static/assets/global/plugins/upload/uploadify.swf',
                    "uploader": "{% url 'upload_license' %}",
                    "formData": {"type": num},
                    "width": 50,
                    "height": 20,//按钮文字
                    "fileDesc": "支持" + type + "格式",
                    "fileTypeExts": type,
                    "fileSizeLimit":"1024KB",
                    "color":"#2374c6",
                    "onSelectError": function (file, errorCode, errorMsg, errorString) {
                        //console.log(errorMsg, errorCode);
                        if (errorCode == "-130") {
                            //alert("文件格式不正确")
                            $.MsgBox.Alert("提示", "文件格式不正确");
                        }
                        else if (errorCode== "-110") {
                            //alert("图片大小不能超过1024K", "图片上传");
                            $.MsgBox.Alert("提示", "文件大小不能超过1024KB");
                        } else {
                            //alert("未知错误");
                            $.MsgBox.Alert("提示","未知错误");
                        }
                    },
                    "onUploadSuccess": function (file, data) {

                        var json = $.parseJSON(data)
                        if (json.code ==0) {
                            $.MsgBox.Alert("提示", "licence注册成功");

                        }
                        else{
                            $.MsgBox.Alert("提示", json.message);
                        }
                    }
                });
            }, 0);

        }
        common.initmenu("log", "license");
      
        uploadfile(1, "*.lic");

        $(document).ready(function(){
            $("#licenseForm").bootstrapValidator({
                 message: '字段不合法',
                feedbackIcons: {
                    valid: 'fa fa-check',
                    invalid: 'fa fa-remove',
                    validating: 'fa fa-refresh'
                },
                fields:{
                    name:{
                        validators:{
                            notEmpty:{
                                message:"用户姓名不能为空"
                            },
                             regexp:{
                                regexp:/^[a-zA-Z|\u4e00-\u9fa5]/,
                                message:"请输入申请人的真实姓名"
                            }
                        }
                    },
                   country:{
                       validators:{
                           notEmpty:{
                               message:"国家/地区不能为空"
                           }
                       }
                   },
                    province:{
                        validators:{
                            notEmpty:{
                                message:"省/市不能为空"
                            },
                            regexp:{
                                regexp:/^[a-zA-Z|\u4e00-\u9fa5]/,
                                message:"请输入合法的省/市"
                            }
                        }
                    },
                    company:{
                        validators:{
                            notEmpty:{
                                message:"公司或者单位名称不能为空"
                            },
                            regexp:{
                                regexp:/^[a-zA-Z|\u4e00-\u9fa5]/,
                                message:"请输入合法的公司或者单位名称"
                            }
                        }
                    },
                    email:{
                        validators:{
                            notEmpty:{
                                message:"邮箱不能为空"
                            },
                            emailAddress:{
                                message:"请输入合法的邮箱"
                            }
                        }
                    },
                    phone:{
                        validators:{
                            notEmpty:{
                                message:"联系电话不能为空"
                            },
                            regexp:{
                                regexp:/^1\d{10}|0\d{2,3}-?\d{7,8}/,
                                message:"请输入合法的联系电话"
                            }
                        }
                    }
                }
            })
        })

    </script>
{% endblock script %}